import{r as t,c as s,h as i,g as h}from"./p-cd65946c.js";const e=class{constructor(i){t(this,i),this.qrScanned=s(this,"qrScanned",7),this.reloadTime=void 0,this.afterScan=void 0}connectedCallback(){this.scanning=!1,this.constraints={facingMode:{exact:"environment"}},this.reloadTime=parseInt(this.reloadTime)}componentDidRender(){this.QRcode=window.qrcode,this.video=document.createElement("video"),this.canvasElement=this.el.shadowRoot.getElementById("qr-canvas"),this.canvas=this.canvasElement.getContext("2d"),this.startScan(),this.QRcode.callback=async t=>{t&&(this.qrScanned.emit(t),this.scanning=!1,this.video.srcObject.getTracks().forEach((t=>{t.stop()})),"stopScan"===this.afterScan?(this.video.srcObject.getTracks().forEach((t=>{t.stop()})),this.canvasElement.hidden=!0):setTimeout(this.startScan.bind(this),this.reloadTime))}}render(){return i("div",{class:"row"},i("canvas",{id:"qr-canvas",style:{height:"auto",width:"100%",borderStyle:"solid"}}))}drawStreamFrame(){this.canvasElement.height=this.video.videoHeight,this.canvasElement.width=this.video.videoWidth,this.canvas.drawImage(this.video,0,0,this.canvasElement.width,this.canvasElement.height),this.scanning&&requestAnimationFrame(this.drawStreamFrame.bind(this))}qrDecode(){try{this.QRcode.decode()}catch(t){setTimeout(this.qrDecode.bind(this),300)}}startScan(){navigator.mediaDevices.getUserMedia({video:this.constraints}).then((t=>{this.scanning=!0,this.canvasElement.hidden=!1,this.video.setAttribute("playsinline",!0),this.video.srcObject=t,this.video.play(),this.drawStreamFrame(),this.qrDecode.bind(this)()})).catch((()=>{this.constraints={facingMode:"environment"},this.startScan()}))}get el(){return h(this)}};e.style=":host{display:block}";export{e as qr_reader}